{% extends "base.html" %}

{% block head %}
{% style "/easyui/themes/default/easyui.css" %}
{% style "/easyui/themes/icon.css" %}
{% style "/easyui/themes/color.css" %}
{% endblock %}

{% block content %}
{% csrf-field %}
<table id="dg"
  class="easyui-datagrid datagrid-searchable"
  style="width: 100%"
  title="{{ title }}"
  data-options="
  url: '/inventario/json/grid',
  toolbar: '#toolbar',
  queryParams: {'__anti-forgery-token':token},
  pagination: true,
  rownumbers: true,
  nowrap: true,
  autoRowHeight: false,
  fitColumns: true,
  autoSizeColumn: true,
  singleSelect: true">
  <thead>
    <tr>
      <th data-options="field: 'p_nombre', sortable: true">Producto</th>
      <th data-options="field: 'n_parte', sortable: true" formatter="formatParte">Parte#</th>
      <th data-options="field: 'p_etiqueta', sortable: true">Etiqueta</th>
      <th data-options="field: 'inv_inicio', sortable: true, align:'right'">Inicio</th>
      <th data-options="field: 'inv_recibido', sortable: true, align:'right'">Recibido</th>
      <th data-options="field: 'inv_enviado', sortable: true, align:'right'">Enviado</th>
      <th data-options="field: 'inv_en_mano', sortable: true, align:'right'" formatter="formatMinimo">En Mano</th>
      <th data-options="field: 'r_minimo', sortable: true, align:'right'">Minimo Requerido</th>
    </tr>
  </thead>
</table>
<div id="toolbar">
    <a href="javascript:void(0)"
       class="easyui-linkbutton"
       data-options="iconCls: 'icon-add',plain: true"
       onclick="defaultGridNewItem()">Crear</a>
    <a href="javascript:void(0)"
       class="easyui-linkbutton"
       data-options="iconCls: 'icon-edit',plain: true"
       onclick="defaultGridEditItem({})">Editar</a>
    <a href="javascript:void(0)"
       class="easyui-linkbutton"
       data-options="iconCls: 'icon-remove',plain: true"
       onclick="defaultGridDeleteItem()">Remover</a>
    <div style="float: right">
        <input class="easyui-textbox" id="datagrid-searchbox" data-options="prompt: 'Busqueda'" title="Buscar">
    </div>
</div>
<div class="easyui-dialog dlg" data-options="closed:true,buttons:'#dlg-buttons'" style="padding:5px;width:70%;">
  <form class="fm" method="POST" enctype="multipart/form-data" novalidate>
    <input type="hidden" id="id" name="id">
    <div class="form-group col-11">
      <label for="p_nombre">Producto:</label>
      <input id="p_nombre" name="p_nombre" class="form-control easyui-textbox" data-options="required:true">
    </div>

    <div class="form-group col-11">
      <label for="n_parte">Parte#:</label>
      <input id="n_parte" name="n_parte" class="form-control easyui-textbox" data-options="required:true">
    </div>

    <div class="form-group col-11">
      <label for="p_etiqueta">Etiqueta:</label>
      <input id="p_etiqueta" name="p_etiqueta" class="form-control easyui-textbox" data-options="required:true">
    </div>

    <div class="form-group col-11">
      <label for="inv_inicio">Inicio:</label>
      <input id="inv_inicio" name="inv_inicio" class="form-control easyui-numberbox" data-options="required:true,min:0,precision:0">
    </div>

    <div class="form-group col-11">
      <label for="inv_recibido">Recibido:</label>
      <input id="inv_recibido" name="inv_recibido" class="form-control easyui-numberbox" data-options="required:true,min:0,precision:0">
    </div>

    <div class="form-group col-11">
      <label for="inv_envidado">Enviado:</label>
      <input id="inv_enviado" name="inv_enviado" class="form-control easyui-numberbox" data-options="required:true,min:0,precision:0">
    </div>

    <div class="form-group col-11">
      <label for="inv_en_mano">En mano:</label>
      <input id="inv_en_mano" name="inv_en_mano" class="form-control easyui-numberbox" data-options="required:true,min:0,precision:0">
    </div>
    
    <div class="form-group col-11">
      <label for="r_minimo">Minimo Requerido:</label>
      <input id="r_minimo" name="r_minimo" class="form-control easyui-numberbox" data-options="required:true,min:0,precision:0">
    </div>

  </form>
</div>
<div id="dlg-buttons">
    <a href="javascript:void(0)"
       class="easyui-linkbutton"
       data-options="iconCls: 'icon-ok'"
       onclick="defaultGridSaveItem()">Postear</a>
    <a href="javascript:void(0)"
       class="easyui-linkbutton"
       data-options="iconCls: 'icon-cancel'"
       onclick="defaultGridDialogClose()">Cancelar</a>
</div>
<div style="align:left;">
  <h5><span class="badge" style="background-color:gold;">Reordenar Inventario</span></h5>
  <h5><span class="badge" style="background-color:red">Inventario Negativo</span></h5>
</div>
{% endblock %}

{% block scripts %}
{% script "/easyui/jquery.easyui.min.js" %}
{% script "/easyui/plugins/jquery.datagrid.js" %}
{% script "/easyui/datagrid-detailview.js" %}
{% script "/js/jquery.maskedinput.min.js" %}
{% script "/easyui/locale/easyui-lang-es.js" %}
<script type="text/javascript" src="/js/defaultGrid.js"></script>
<script>
  function formatMinimo(val,row) {
    if(val < 1){
      return '<span style="color:red">' + val + '</span>';
    } else {
      return val;
    }
  }

function formatParte(val,row) {
  if(row.inv_en_mano < row.r_minimo) {
    return '<span style="color:gold;">' + val + '</span>';
  } else {
    return val;
  }
}

$(document).ready(function() {
  var dataGridOptions = dataGrid.datagrid('options');
  dataGridOptions.view = detailview;
  dataGridOptions.detailFormatter = function() {
    return '<div class="ddv" style="padding:5px 0;"></div>';
  };
  dataGridOptions.onExpandRow = function (index, row) {
    var ddv = $(this).datagrid('getRowDetail', index).find('div.ddv');
    var url = "/inventario/detalles/" + row.id;
    ddv.panel({
      height:'auto',
      border:false,
      cache:false,
      queryParams: {},
      method:'GET',
      href:url,
      onLoad:function() {
        dataGrid.datagrid('fixDetailRowHeight', index);
      }
    });
    dataGrid.datagrid('fixDetailRowHeight', index);
  }
});
</script>
{% endblock %}
